I"ıä<p>p2p í™”ìƒì±„íŒ… êµ¬í˜„ì„ ìœ„í•´ ìŠ¤í„°ë””í•œ ë‚´ìš©ì„ ê¸°ë¡í•œë‹¤.<br />
ì´ ì‹œë¦¬ì¦ˆì—ì„œëŠ” ì§ì ‘ êµ¬í˜„í•´ë‚˜ê°€ë©´ì„œ ê²½í—˜í•œ ë¬¸ì œì™€ í•´ê²° ë°©ë²•ë“¤ì„ ìˆœì„œëŒ€ë¡œ ê¸°ë¡í•˜ê¸° ë•Œë¬¸ì— ì¢€ ëŒì•„ê°ˆ ìˆ˜ë„ ìˆë‹¤.<br />
ì™„ì„±ëœ ì½”ë“œë¥¼ ë¨¼ì € ë³´ê³  ì§ì ‘ ë¶„ì„í•˜ê³  ì‹¶ë‹¤ë©´, ë§¨ ë§ˆì§€ë§‰ì— ìˆëŠ” ê¹ƒí—™ ì£¼ì†Œë¥¼ ì°¸ì¡°í•˜ê¸° ë°”ë€ë‹¤.</p>

<link href="/assets/toc.css" rel="stylesheet" />

<nav class="toc">
  <h2 class="no_toc" id="section">ëª©ì°¨</h2>

<ol id="markdown-toc">
  <li><a href="#11-ë¹„ë””ì˜¤-ì¤‘ê³„-ì„œë¹„ìŠ¤ì˜-ë¬¸ì œ" id="markdown-toc-11-ë¹„ë””ì˜¤-ì¤‘ê³„-ì„œë¹„ìŠ¤ì˜-ë¬¸ì œ">1:1 ë¹„ë””ì˜¤ ì¤‘ê³„ ì„œë¹„ìŠ¤ì˜ ë¬¸ì œ</a></li>
  <li><a href="#í´ë¼ì´ì–¸íŠ¸-ì–´í”Œë¦¬ì¼€ì´ì…˜-êµ¬ì„±" id="markdown-toc-í´ë¼ì´ì–¸íŠ¸-ì–´í”Œë¦¬ì¼€ì´ì…˜-êµ¬ì„±">í´ë¼ì´ì–¸íŠ¸ ì–´í”Œë¦¬ì¼€ì´ì…˜ êµ¬ì„±</a></li>
  <li><a href="#í™”ë©´ì—-ì›¹ìº -ìŠ¤íŠ¸ë¦¬ë°-í‘œì‹œí•˜ê¸°" id="markdown-toc-í™”ë©´ì—-ì›¹ìº -ìŠ¤íŠ¸ë¦¬ë°-í‘œì‹œí•˜ê¸°">í™”ë©´ì— ì›¹ìº  ìŠ¤íŠ¸ë¦¬ë° í‘œì‹œí•˜ê¸°</a></li>
  <li><a href="#rtc-ì—°ê²°-ìƒì„±í•˜ê¸°-1" id="markdown-toc-rtc-ì—°ê²°-ìƒì„±í•˜ê¸°-1">RTC ì—°ê²° ìƒì„±í•˜ê¸° (1)</a>    <ol>
      <li><a href="#sdp-êµí™˜-ë‹¨ê³„" id="markdown-toc-sdp-êµí™˜-ë‹¨ê³„">SDP êµí™˜ ë‹¨ê³„</a></li>
    </ol>
  </li>
  <li><a href="#signaling-server-êµ¬í˜„" id="markdown-toc-signaling-server-êµ¬í˜„">Signaling Server êµ¬í˜„</a>    <ol>
      <li><a href="#ï¸ì£¼ì˜ì‚¬í•­" id="markdown-toc-ï¸ì£¼ì˜ì‚¬í•­">âš ï¸ì£¼ì˜ì‚¬í•­</a></li>
    </ol>
  </li>
  <li><a href="#rtc-ì—°ê²°-ìƒì„±í•˜ê¸°-2" id="markdown-toc-rtc-ì—°ê²°-ìƒì„±í•˜ê¸°-2">RTC ì—°ê²° ìƒì„±í•˜ê¸° (2)</a>    <ol>
      <li><a href="#ice-êµí™˜-ë‹¨ê³„" id="markdown-toc-ice-êµí™˜-ë‹¨ê³„">ICE êµí™˜ ë‹¨ê³„</a></li>
    </ol>
  </li>
  <li><a href="#caller-callee-ì½”ë“œ-í†µí•©-ë°-ì •ë¦¬" id="markdown-toc-caller-callee-ì½”ë“œ-í†µí•©-ë°-ì •ë¦¬">Caller, Callee ì½”ë“œ í†µí•© ë° ì •ë¦¬</a></li>
</ol>

</nav>

<blockquote>
  <p>WebRTCëŠ” ê°„ë‹¨í•œ APIë¥¼ í†µí•´ ë¸Œë¼ìš°ì €ì™€ ëª¨ë°”ì¼ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ì‹¤ì‹œê°„ í†µì‹  (RTC) ê¸°ëŠ¥ì„ ì œê³µí•˜ëŠ” ë¬´ë£Œ ê°œë°©í˜• í”„ë¡œì íŠ¸ì…ë‹ˆë‹¤. WebRTC êµ¬ì„± ìš”ì†ŒëŠ” ì´ëŸ¬í•œ ëª©ì ì— ê°€ì¥ ì í•©í•˜ë„ë¡ ìµœì í™”ë˜ì—ˆìŠµë‹ˆë‹¤. <br />
- <a href="https://webrtc.github.io/webrtc-org/">webrtc.org</a></p>
</blockquote>

<h2 id="11-ë¹„ë””ì˜¤-ì¤‘ê³„-ì„œë¹„ìŠ¤ì˜-ë¬¸ì œ">1:1 ë¹„ë””ì˜¤ ì¤‘ê³„ ì„œë¹„ìŠ¤ì˜ ë¬¸ì œ</h2>

<p>ì² ìˆ˜ì™€ ì˜í¬ê°€ ì „í˜•ì ì¸ httpë‚˜ ì›¹ ì†Œì¼“ í†µì„ ì´ìš©í•œ ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•´ì„œ ë©”ì‹œì§€ë¥¼ ì£¼ê³ ë°›ëŠ” ìƒí™©ì„ ëª¨ë¸ë§í•´ë³´ì.
ì¼ë°˜ì ìœ¼ë¡œ ì‚¬ìš©ìê°„ì˜ ë°ì´í„° ì „ì†¡ì„ í•˜ê¸° ìœ„í•´ì„œëŠ” ê³ ì •ëœ ì ‘ê·¼ê²½ë¡œ(ip / domain)ì„ ê°€ì§„ ì›¹ì„œë²„ì— ì—¬ëŸ¬ ì‚¬ìš©ìê°€ 
ì ‘ì†í•˜ì—¬ ì„œë¡œ í†µì‹ ì„ í•œë‹¤.</p>

<div class="mermaid"> 
sequenceDiagram
Participant ì² ìˆ˜
Participant server
Participant ì˜í¬
ì² ìˆ˜-&gt;&gt;server: ì˜í¬ì•¼(18byte)
server-&gt;&gt;ì˜í¬: ì˜í¬ì•¼(18byte)
ì˜í¬--&gt;&gt;server: êº¼ì ¸(6byte)
server--&gt;&gt;ì² ìˆ˜: êº¼ì ¸(6byte)
Note over ì² ìˆ˜: send: 18byte, recieve: 6byte
Note over ì˜í¬: send: 6byte, recieve: 18byte
Note over server: send: 24byte, recieve: 24byte 
</div>

<p>ì‹¤ì œ ì£¼ê³  ë°›ëŠ” ì •ë³´ì˜ ì–‘ì— ë¹„í•´ ì¤‘ê³„ì„œë²„ì˜ ë¶€ë‹´ì´ ìƒë‹¹í•˜ë‹¤. ë§Œì•½ ì‹¤ì‹œê°„ ë¹„ë””ì˜¤ì™€ ê°™ì€ ëŒ€ëŸ‰ì˜ ë°ì´í„°ê°€
ì´ëŸ¬í•œ ë°©ì‹ìœ¼ë¡œ ì˜¤ê°„ë‹¤ë©´ ìƒë‹¹í•œ ë¹„ìš©ì´ í•„ìš”í•  ë¿ ì•„ë‹ˆë¼ ì„œë²„ ì»¨ë””ì…˜ì— ë”°ë¼ ì„œë¹„ìŠ¤ í’ˆì§ˆì—ë„ ìƒë‹¹í•œ ì˜í–¥ì´ ìˆì„ê²ƒì´ë‹¤.
ë°˜ë©´ ë°ì´í„°ë¥¼ ì‚¬ìš©ìê°„ì— ì§ì ‘ ì£¼ê³ ë°›ì„ ìˆ˜ ìˆë‹¤ë©´ (peer-to-peer) ì„œë²„ê°€ ë¶€ë‹´í•˜ëŠ” íŠ¸ë˜í”½ì€ ê±°ì˜ ì—†ì–´ì§ˆ ìˆ˜ ìˆê³ 
ë§ì€ ë¹„ìš© ì ˆê°ê³¼ í•¨ê»˜ ì‚¬ìš©ì ì…ì¥ì—ì„œë„ í’ˆì§ˆ í–¥ìƒì„ ì´ë£° ìˆ˜ ìˆë‹¤.</p>

<div class="mermaid"> 
sequenceDiagram
Participant ì² ìˆ˜
Participant server
Participant ì˜í¬
ì² ìˆ˜-&gt;&gt;ì˜í¬: ì˜í¬ì•¼(18byte)
ì˜í¬--&gt;&gt;ì² ìˆ˜: êº¼ì ¸(6byte)
Note over ì² ìˆ˜: send: 18byte, recieve: 6byte
Note over ì˜í¬: send: 6byte, recieve: 18byte 
</div>

<p>í•˜ì§€ë§Œ ì´ë¥¼ ì‹¤ì œ êµ¬í˜„í•˜ê¸° ìœ„í•œ ì—¬ëŸ¬ê°€ì§€ ê¸°ìˆ ì  ê³¼ì œë“¤ì€ ê°„ë‹¨í•œ ë¬¸ì œê°€ ì•„ë‹ˆë©°, ë¸Œë¼ìš°ì €ì™€ ì„œë²„ê°„ì˜ 
ë™ê¸°/ë¹„ë™ê¸°ì  í†µì‹ ìœ¼ë¡œ ëŒ€í‘œë˜ëŠ” ì „í†µì ì¸ ì›¹ë¸Œë¼ìš°ì§• ë°©ì‹ìœ¼ë¡œëŠ” í•´ê²°í•˜ê¸° ì‰½ì§€ ì•Šë‹¤. 
ë‹¤í–‰íˆ ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•œ ê³µí†µì ì¸ êµ¬í˜„ì´ <a href="https://webrtc.org/">WebRTC</a>ë¼ëŠ” ì´ë¦„ì˜ ì˜¤í”ˆì†ŒìŠ¤ ì›¹ í‘œì¤€ìœ¼ë¡œ ì •ì˜ë˜ì–´ ìˆê³ , 
í˜„ì¬ ê±°ì˜ ëª¨ë“  ëª¨ë˜ ë¸Œë¼ìš°ì €ì— êµ¬í˜„ë˜ì–´ ìˆì–´, 
ê°„ë‹¨í•œ <a href="https://developer.mozilla.org/ko/docs/Web/API/WebRTC_API">javascript API</a> ì‚¬ìš©ë§Œìœ¼ë¡œ ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤.</p>

<p>ë‹¤ë§Œ ì´ëŸ¬í•œ API ë¥¼ ì‚¬ìš©í•œë‹¤ í•´ë„ ì‹¤ì œ êµ¬í˜„ì‹œ ë°œìƒí•˜ëŠ” ì—¬ëŸ¬ê°€ì§€ ë¬¸ì œë“¤ì„ best practiceë¡œ í•´ê²°í•˜ê¸°ë€ ì‰½ì§€ ì•Šì€ ì¼ì´ë©°, 
<a href="https://www.npmjs.com/search?q=webrtc&amp;ranking=popularity">ì˜ êµ¬í˜„ëœ ë¼ì´ë¸ŒëŸ¬ë¦¬ë‚˜</a>
<a href="https://www.html5rocks.com/ko/tutorials/webrtc/infrastructure/#readymade-signaling-servers">ì›¹ì„œë¹„ìŠ¤</a>
ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ í˜„ëª…í•  ìˆ˜ë„ ìˆë‹¤.
ê·¸ëŸ¬ë‚˜ ê´€ë ¨ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•œë‹¤ í•˜ë”ë¼ë„ ê·¸ ê¸°ë°˜ì„ ì´ë£¨ê³  ìˆëŠ” ê¸°ìˆ ê³¼ ê¸°ë³¸ì ì¸ í”„ë¡œí† ì½œì— ëŒ€í•œ ì´í•´ëŠ” í•„ìˆ˜ì ì´ë‹¤.
ê·¸ëŸ¬ë¯€ë¡œ WebRTC APIë¥¼ ì§ì ‘ ì´ìš©í•´ ê°€ì¥ ë‹¨ìˆœí•œ êµ¬í˜„ë¶€í„° ì‹œì‘í•´ë³´ê¸°ë¡œ í•œë‹¤.</p>

<p>ì´ ìŠ¤í„°ë””ì˜ ëª©í‘œëŠ” ì›¹ìº  í™”ë©´ì„ ë¸Œë¼ìš°ì €ì— ë„ìš°ëŠ” ê²ƒë¶€í„° ì‹œì‘í•´ì„œ 
AWSë¥¼ í†µí•´ ëª¨ë°”ì¼ í¬ë¡œìŠ¤ í”Œë«í¼ ê°„ì— 1:1 p2pí†µì‹ ì„ ì´ìš©í•˜ì—¬ ì˜ìƒ ë° ì±„íŒ… ë©”ì‹œì§€ë¥¼ ì „ì†¡í• ìˆ˜ ìˆë„ë¡ êµ¬í˜„í•˜ëŠ” ê²ƒ ê¹Œì§€ì´ë‹¤.</p>

<h2 id="í´ë¼ì´ì–¸íŠ¸-ì–´í”Œë¦¬ì¼€ì´ì…˜-êµ¬ì„±">í´ë¼ì´ì–¸íŠ¸ ì–´í”Œë¦¬ì¼€ì´ì…˜ êµ¬ì„±</h2>

<p>1:1 í™”ìƒì±„íŒ…ì„ ì—°ê²°í•˜ëŠ” ë‹¨ê³„ì˜ ë¡œì§ì€ ìš”ì²­í•˜ëŠ” ìª½ê³¼ ë°›ëŠ”ìª½ì˜ ë¡œì§ìœ¼ë¡œ ë‚˜ëˆŒ ìˆ˜ ìˆë‹¤.
ì™„ì„±ë‹¨ê³„ì—ì„œëŠ” í•˜ë‚˜ì˜ í™”ë©´ìœ¼ë¡œ í•©ì³ì§€ê² ì§€ë§Œ ê³¼ì •ì˜ ì´í•´ë¥¼ ì‰½ê²Œ í•˜ê¸°ìœ„í•´ ì²˜ìŒì—ëŠ” callerì™€ callee ë‘ í™”ë©´ìœ¼ë¡œ ë‚˜ëˆ„ì–´ì„œ êµ¬ì„±í•œë‹¤.
Boiler Plates ì½”ë“œë¥¼ ìµœì†Œí™” í•˜ê¸° ìœ„í•´ ë³„ë„ì˜ ë²ˆë“¤ëŸ¬ë¥¼ ì´ìš©í•˜ì§€ ì•Šê³  ë‹¨ìˆœí•œ ìŠ¤íƒœí‹± íŒŒì¼ë¡œ ì‘ì„±í•  ê²ƒì´ë‹¤.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/
â””â”€ client/
   â”œ caller.html
   â”œ caller.js
   â”œ callee.html
   â”” callee.js
</code></pre></div></div>

<p>ì´ ìŠ¤íƒœí‹± í˜ì´ì§€ë“¤ì€ ë‚˜ì¤‘ì— êµ¬í˜„í•  Node.js ì„œë²„ë¥¼ í†µí•´ì„œ ì„œë¹™ë  ì˜ˆì •ì´ë‹¤.</p>

<h2 id="í™”ë©´ì—-ì›¹ìº -ìŠ¤íŠ¸ë¦¬ë°-í‘œì‹œí•˜ê¸°">í™”ë©´ì— ì›¹ìº  ìŠ¤íŠ¸ë¦¬ë° í‘œì‹œí•˜ê¸°</h2>

<p>ë³µì¡í•œ ê¸°ìˆ ì  ì‚¬í•­ì„ ë‹¤ë£¨ëŠë¼ í¥ë¯¸ë¥¼ ìƒê¸° ì „ì— ë°”ë¡œ í™”ë©´ë¶€í„° ë„ì›Œë³´ì.</p>

<p><strong>caller.html</strong>, <strong>callee.html</strong> ë™ì¼í•˜ê²Œ</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!doctype html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"UTF-8"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;title&gt;</span>WebRTC<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
<span class="c">&lt;!--ë‚´ ì–¼êµ´ì´ ë‚˜ì˜¬ video ìš”ì†Œ--&gt;</span>
<span class="nt">&lt;video</span> <span class="na">id=</span><span class="s">"localVideo"</span> <span class="na">autoplay</span> <span class="na">width=</span><span class="s">"480px"</span><span class="nt">&gt;&lt;/video&gt;</span>
<span class="c">&lt;!--ìƒëŒ€ë°©ì˜ ì–¼êµ´ì´ ë‚˜ì˜¬ video ìš”ì†Œ--&gt;</span>
<span class="nt">&lt;video</span> <span class="na">id=</span><span class="s">"remoteVideo"</span> <span class="na">autoplay</span> <span class="na">width=</span><span class="s">"480px"</span><span class="nt">&gt;&lt;/video&gt;</span>
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"caller.js(ë˜ëŠ” callee.js)"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<p><strong>caller.js</strong>, <strong>callee.js</strong> ë™ì¼í•˜ê²Œ</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">mediaStream</span> <span class="o">=</span> <span class="k">await</span> <span class="nb">navigator</span><span class="p">.</span><span class="nx">mediaDevices</span><span class="p">.</span><span class="nx">getUserMedia</span><span class="p">({</span> <span class="na">video</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="na">audio</span><span class="p">:</span> <span class="kc">false</span> <span class="p">});</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">localVideo</span><span class="dl">'</span><span class="p">).</span><span class="nx">srcObject</span> <span class="o">=</span> <span class="nx">mediaStream</span><span class="p">;</span>

  <span class="c1">// ì´í›„ ì½”ë“œëŠ” ëª¨ë‘ ì´ async í•¨ìˆ˜ ì•ˆì— ì‘ì„±í•œë‹¤.</span>
<span class="p">})();</span>
</code></pre></div></div>

<p>ìœ„ì™€ ê°™ì´ ì‘ì„±í•˜ê³  caller.html ë˜ëŠ” callee.html ì„ ë¸Œë¼ìš°ì €ë¡œ ë„ìš°ë©´ ì‚¬ìš©ìì—ê²Œ ë¹„ë””ì˜¤ ì „ì†¡ í—ˆìš© ì—¬ë¶€ë¥¼ ë¬»ê³ 
ì´í›„ ì›¹ìº  í™”ë©´ì´ ë¸Œë¼ìš°ì €ì— ë‚˜íƒ€ë‚˜ê¸° ì‹œì‘í•œë‹¤.</p>

<h2 id="rtc-ì—°ê²°-ìƒì„±í•˜ê¸°-1">RTC ì—°ê²° ìƒì„±í•˜ê¸° (1)</h2>

<p>WebRTC í†µì‹ ì€ <code class="language-plaintext highlighter-rouge">RTCPeerConnection</code> ê°ì²´ë¥¼ í†µí•´ì„œ ì´ë£¨ì–´ì§„ë‹¤. 
caller, callee ì–‘ìª½ì—ì„œ ë™ì¼í•˜ê²Œ ë‹¤ìŒê³¼ ê°™ì´ ìƒì„±í•˜ê³  <code class="language-plaintext highlighter-rouge">addTrack</code> ë©”ì˜ë“œë¥¼ í†µí•´ ìƒëŒ€í¸ì—ê²Œ ì „ì†¡í•  ë¯¸ë””ì–´ ìŠ¤íŠ¸ë¦¼ì„ ì—°ê²°í•´ì¤„ ìˆ˜ ìˆë‹¤.</p>

<p><strong>caller.js</strong>, <strong>callee.js</strong> ë™ì¼í•˜ê²Œ</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/*ì•ì˜ async í•¨ìˆ˜ ë‚´ë¶€ì—*/</span>
<span class="kd">const</span> <span class="nx">rtcPeerConnection</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">RTCPeerConnection</span><span class="p">();</span>
<span class="nx">mediaStream</span><span class="p">.</span><span class="nx">getTracks</span><span class="p">().</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">track</span> <span class="o">=&gt;</span> <span class="nx">rtcPeerConnection</span><span class="p">.</span><span class="nx">addTrack</span><span class="p">(</span><span class="nx">track</span><span class="p">));</span>
</code></pre></div></div>

<p>(ê°„í˜¹ <code class="language-plaintext highlighter-rouge">addTrack</code> ëŒ€ì‹  <code class="language-plaintext highlighter-rouge">addStream</code>ì„ ì´ìš©í•œ ì˜ˆì œê°€ ìˆëŠ”ë° <a href="https://developer.mozilla.org/en-US/docs/Web/API/RTCPeerConnection/addStream">deprecate</a>ë˜ì—ˆë‹¤.
apiê°€ ìµœê·¼ì— êµ¬í˜„ëœ ì¼ë¶€ ë¸Œë¼ìš°ì €ì—ì„œ ì‘ë™í•˜ì§€ ì•ŠëŠ”ë‹¤.)</p>

<p>ì´ì œ ì–‘ìª½ í´ë¼ì´ì–¸íŠ¸ì˜ <code class="language-plaintext highlighter-rouge">RTCPeerConnection</code>ëŠ” ì„œë¡œ ë‘ ê°€ì§€ ì •ë³´ë¥¼ êµí™˜í•´ì•¼ í•˜ëŠ”ë°</p>

<ul>
  <li>ì–´ë–¤ ê²½ë¡œë¥¼ í†µí•´ì„œ ì ‘ê·¼í•´ì•¼ í•˜ëŠ”ì§€ <strong>(SDP - Session Description Protocol)</strong> ì™€</li>
  <li>ì–´ë–¤ í˜•ì‹ìœ¼ë¡œ ë°ì´í„°ë¥¼ ì£¼ê³  ë°›ì„ì§€ <strong>(ICE - Interactive Connectivity Establishment)</strong> ë¥¼ í˜‘ì˜í•œ í›„ ì‹¤ì œ ë°ì´í„°ë¥¼ ì£¼ê³  ë°›ê²Œ ëœë‹¤.</li>
</ul>

<p>ì´ëŸ¬í•œ ê³¼ì •ì„ negotiationì´ë¼ê³  í•˜ê³ , ì´ëŸ¬í•œ ê³¼ì •ì´ í•„ìš”í•˜ë‹¤ê³  íŒë‹¨ë  ì‹œ (ì—°ê²° ì´ˆê¸° ì…‹ì—…(e.g. addTrack), 
ë˜ëŠ” í™˜ê²½ ë³€í™”ë¡œ ì¬í˜‘ìƒì´ í•„ìš”í• ë•Œ) ë¸Œë¼ìš°ì €ëŠ” <code class="language-plaintext highlighter-rouge">negotiationneeded</code> ì´ë²¤íŠ¸ë¥¼ ë°œìƒì‹œí‚¨ë‹¤.</p>

<h3 id="sdp-êµí™˜-ë‹¨ê³„">SDP êµí™˜ ë‹¨ê³„</h3>

<p><code class="language-plaintext highlighter-rouge">negotiation</code>ì´ í•„ìš”í•˜ë‹¤ê³  í•˜ë‹ˆê¹Œ ì´ ì´ë²¤íŠ¸ì˜ í•¸ë“¤ëŸ¬ì—ì„œ ë¨¼ì € SDP êµí™˜ì„ êµ¬í˜„í•´ì¤€ë‹¤.
ë‘ í´ë¼ì´ì–¸íŠ¸ëŠ” ì•„ë˜ ê³¼ì •ì„ ê±°ì³ì„œ ì„œë¡œì—ê²Œ ì–´ë–»ê²Œ ì ‘ì†í•´ì•¼ í• ì§€ì— ëŒ€í•œ ì •ë³´ (localDescription, remoteDescription)ë¥¼ êµí™˜í•˜ê²Œ ëœë‹¤.</p>

<div class="mermaid"> 
sequenceDiagram
caller-&gt;&gt;caller: createOffer()
Note left of caller: LocalDescription = offer
caller-&gt;&gt;callee: offerSDP
Note right of callee: RemoteDescription = offer
callee-&gt;&gt;callee: createAnswer()
Note right of callee: LocalDescription = answer
callee--&gt;&gt;caller: answerSDP
Note left of caller: RemoteDescription = answer 
</div>

<p>ë‹¤ì´ì–´ê·¸ë¨ì„ ë³´ë©´ callerì¸¡ê³¼ calleeì¸¡ì´ ì„œë¡œ í†µì‹ ì„ í•˜ëŠ”ë° ì´ í†µì‹  ìì²´ì— ëŒ€í•œ êµ¬í˜„ì€ ë‚˜ì¤‘ìœ¼ë¡œ ë¯¸ë£° ê²ƒì´ë‹¤.
ì•„ë˜ ì˜ˆì œëŠ” í´ë¼ì´ì–¸íŠ¸ ê°„ ë©”ì‹œì§€ êµí™˜ì„ ìœ„í•œ <code class="language-plaintext highlighter-rouge">onMessage</code>, <code class="language-plaintext highlighter-rouge">sendMessage</code> ë©”ì†Œë“œê°€ êµ¬í˜„ë˜ì–´ ìˆë‹¤ê³  ê°€ì •í•˜ê³  ì‘ì„±í•œë‹¤.</p>

<p>ë©”ì‹œì§€ êµí™˜ ìˆœì„œì˜ ì´í•´ë¥¼ ë•ê¸° ìœ„í•´ caller, callee ì‚¬ì´ì— ë©”ì‹œì§€ê°€ ì˜¤ê°€ëŠ” ìˆœì„œëŒ€ë¡œ ì‘ì„±í•œë‹¤.</p>

<p>âš ï¸ ê°ê° ì–´ëŠ íŒŒì¼ì— ì‘ì„±í•´ì•¼ í•˜ëŠ”ì§€ì— ì£¼ì˜</p>

<p><strong>caller.js</strong></p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/*ì•ì˜ ì½”ë“œì— ì´ì–´ì„œ*/</span> 
<span class="nx">rtcPeerConnection</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">negotiationneeded</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// ì´ìª½í¸ì— ì ‘ì†í•˜ê¸° ìœ„í•œ ì •ë³´ë¥¼ ìƒì„±í•´ì„œ local session descriptionì— ì„¤ì •</span>
  <span class="kd">const</span> <span class="nx">sdpOffer</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">rtcPeerConnection</span><span class="p">.</span><span class="nx">createOffer</span><span class="p">();</span> <span class="c1">// { type: 'offer', sdp: '...' }</span>
  <span class="nx">rtcPeerConnection</span><span class="p">.</span><span class="nx">setLocalDescription</span><span class="p">(</span><span class="nx">sdpOffer</span><span class="p">);</span>
  
  <span class="c1">// ìƒëŒ€í¸ì—ê²Œ ì „ì†¡ -&gt; callee.js, onMessage('SDP')</span>
  <span class="nx">sendMessage</span><span class="p">(</span><span class="dl">'</span><span class="s1">SDP</span><span class="dl">'</span><span class="p">,</span> <span class="nx">sdpOffer</span><span class="p">)</span> 
<span class="p">});</span>
</code></pre></div></div>

<p><strong>callee.js</strong></p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/*ì•ì˜ ì½”ë“œì— ì´ì–´ì„œ*/</span>
<span class="nx">onMessage</span><span class="p">(</span><span class="dl">'</span><span class="s1">SDP</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="nx">sdpOffer</span> <span class="o">=&gt;</span> <span class="p">{</span>  
  <span class="c1">// caller ì—ì„œ ë„˜ì–´ì˜¨ sdp ë°ì´í„°ë¥¼ ì´ìš©í•´ì„œ remote session descriptionì„ ì„¤ì •  </span>
  <span class="k">await</span> <span class="nx">rtcPeerConnection</span><span class="p">.</span><span class="nx">setRemoteDescription</span><span class="p">(</span><span class="k">new</span> <span class="nx">RTCSessionDescription</span><span class="p">(</span><span class="nx">sdpOffer</span><span class="p">));</span> 

  <span class="c1">// answer íƒ€ì…ì˜ session descriptionì„ ìƒì„±í•´ì„œ localì— ì„¤ì •</span>
  <span class="kd">const</span> <span class="nx">sdpAnswer</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">rtcPeerConnection</span><span class="p">.</span><span class="nx">createAnswer</span><span class="p">();</span>
  <span class="k">await</span> <span class="nx">rtcPeerConnection</span><span class="p">.</span><span class="nx">setLocalDescription</span><span class="p">(</span><span class="nx">sdpAnswer</span><span class="p">);</span>

  <span class="c1">// callerì—ê²Œ ë‹¤ì‹œ ì „ì†¡</span>
  <span class="nx">sendMessage</span><span class="p">(</span><span class="dl">'</span><span class="s1">SDP</span><span class="dl">'</span><span class="p">,</span> <span class="nx">sdpAnswer</span><span class="p">);</span>
<span class="p">});</span> 
</code></pre></div></div>

<p><strong>ë‹¤ì‹œ caller.js</strong></p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">onMessage</span><span class="p">(</span><span class="dl">'</span><span class="s1">SDP</span><span class="dl">'</span><span class="p">,</span> <span class="nx">sdpAnswer</span> <span class="o">=&gt;</span> <span class="p">{</span> 
  <span class="c1">// callee ì—ì„œ ë„˜ì–´ì˜¨ sdp ë°ì´í„°ë¥¼ ì´ìš©í•´ì„œ remote session descriptionì„ ì„¤ì •  </span>
  <span class="nx">rtcPeerConnection</span><span class="p">.</span><span class="nx">setRemoteDescription</span><span class="p">(</span><span class="k">new</span> <span class="nx">RTCSessionDescription</span><span class="p">(</span><span class="nx">sdpAnswer</span><span class="p">));</span> 
<span class="p">});</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">rtcPeerConnection.setRemoteDescription</code>ë¥¼ í˜¸ì¶œí•˜ì—¬ ìƒëŒ€í¸ ë¸Œë¼ìš°ì €ì— ì—°ê²°í•  ì£¼ì†Œì •ë³´ë¥¼ ì„¤ì •í•´ì£¼ë©´ 
ì´ì œ ì„œë¡œ ìƒëŒ€ë°©ì„ ë„¤íŠ¸ì›Œí¬ ìƒì—ì„œ ì‹ë³„í•  ì¤€ë¹„ê°€ ëœ ê²ƒì´ë‹¤. 
ì´ ìƒíƒœê°€ ë˜ë©´ ìƒëŒ€í¸ì—ì„œ ì¶”ê°€í•œ trackì´ ë„˜ì–´ì™€ <code class="language-plaintext highlighter-rouge">track</code> ì´ë²¤íŠ¸ê°€ ë°œìƒí•œë‹¤.</p>

<p><strong>caller.js</strong>, <strong>callee.js</strong> ë™ì¼í•˜ê²Œ</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/*ì•ì˜ ì½”ë“œì— ì´ì–´ì„œ*/</span>
<span class="nx">rtcPeerConnection</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">track</span><span class="dl">'</span><span class="p">,</span> <span class="nx">e</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">remoteVideo</span><span class="dl">'</span><span class="p">).</span><span class="nx">srcObject</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MediaStream</span><span class="p">([</span><span class="nx">e</span><span class="p">.</span><span class="nx">track</span><span class="p">])</span>
<span class="p">});</span>
</code></pre></div></div>
<p>ì´ ì´ë²¤íŠ¸ ê°ì²´ì— ë‹´ê¸´ trackì„ MediaStream ê°ì²´ì— ë‹´ì•„ì„œ <code class="language-plaintext highlighter-rouge">&lt;video /&gt;</code> ìš”ì†Œì˜ <code class="language-plaintext highlighter-rouge">srcObject</code>ë¡œ ì§€ì •í•˜ë©´ 
ì´í›„ connectionì´ ì„±ë¦½ í•œ í›„ì— streamì„ íƒ€ê³  ì „ì†¡ë˜ì–´ ì˜¨ remote video dataë¥¼ í™”ë©´ì— ì†¡ì¶œí•  ìˆ˜ ìˆë‹¤.</p>

<p>í•˜ì§€ë§Œ ì•„ì§ ëª‡ê°€ì§€ ë‚¨ì€ ìˆ™ì œê°€ ìˆë‹¤. ë¨¼ì € ì•ì„œ ì–¸ê¸‰í–ˆë“¯ì´ <code class="language-plaintext highlighter-rouge">onMessage</code>, <code class="language-plaintext highlighter-rouge">sendMessage</code> ë‘ ë©”ì†Œë“œê°€ ì•„ì§ êµ¬í˜„ë˜ì§€ ì•Šì•˜ë‹¤. 
ì´ ë‘ ë©”ì†Œë“œì˜ ì—­í• ê³¼ êµ¬í˜„ ë°©ì‹ì— ëŒ€í•´ì„œ ë‹¤ìŒ ì±•í„°ì—ì„œ ì•Œì•„ë³´ì.</p>

<h2 id="signaling-server-êµ¬í˜„">Signaling Server êµ¬í˜„</h2>

<p>ìœ„ ì½”ë“œì—ì„œ ë³´ì´ëŠ”ë°”ì™€ ê°™ì´ WebRTCë¡œ p2p í†µì‹ ì„ ì‹œì‘í•˜ê¸° ì „, ì„œë¡œ ì–´ë–»ê²Œ ì •ë³´ë¥¼ ì£¼ê³ ë°›ì•„ì•¼ í• ì§€ í˜‘ìƒì„ ê±°ì¹˜ëŠ” ë‹¨ê³„ì—ì„œë„ 
ê° í´ë¼ì´ì–¸íŠ¸ê°„ì— í†µì‹ ì´ í•„ìš”í•˜ë‹¤. í˜„ì¬ êµ¬í˜„ë˜ì§€ ì•Šì€ <code class="language-plaintext highlighter-rouge">onMessage</code>, <code class="language-plaintext highlighter-rouge">sendMessage</code> ë©”ì†Œë“œê°€ ì´ ë¶€ë¶„ì´ë‹¤.</p>

<p>ì´ ë©”ì†Œë“¤ì´ í˜¸ì¶œë˜ëŠ” ìƒí™©ì—ì„œëŠ” ì•„ì§ ì–‘ í´ë¼ì´ì–¸íŠ¸ë“¤ì€ ìƒëŒ€ë°©ì—ê²Œ ì–´ë–»ê²Œ ì ‘ì†í•´ì•¼í• ì§€ ì•Œì§€ ëª»í•˜ë¯€ë¡œ ì§ì ‘ í†µì‹ ì„ í•  ìˆ˜ ì—†ë‹¤.
p2pí†µì‹ ì´ ë¶ˆê°€ëŠ¥í•œ ìƒí™©ì—ì„œ ì´ ë©”ì‹œì§€ë“¤ì€ ì–´ë–»ê²Œ ì£¼ê³  ë°›ì•„ì•¼ í• ê¹Œ? signaling serverë¼ ë¶ˆë¦¬ëŠ” ì„œë²„ê°€ ê·¸ ì—­í• ì„ í•œë‹¤.
ê²°êµ­ ë³¸ê²©ì ì¸ ë¹„ë””ì˜¤ ë°ì´í„°ê°€ ì˜¤ê°€ê¸° ì „ê¹Œì§€ëŠ” ë³¸ í¬ìŠ¤íŒ… ë§¨ ìœ„ì— ìˆëŠ” ë‹¤ì´ì–´ê·¸ë¨ê³¼ ê°™ì´ ì¤‘ê³„ì„œë²„ë¥¼ í†µí•œ í†µì‹ ì„ í•´ì•¼ë§Œ í•œë‹¤.</p>

<p>ì´ signaling serverëŠ” ì„œë¹„ìŠ¤ ì„±ê²©ì— ë”°ë¼ì„œ ë§¤ìš° ë‹¤ì–‘í•œ ì—­í• ì„ ìˆ˜í–‰í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì— í‘œì¤€ìœ¼ë¡œ ì •í•´ì§„ êµ¬í˜„ì´ ì—†ê³ , 
ì„œë¹„ìŠ¤ì˜ ìš”êµ¬ì‚¬í•­ê³¼ ìƒí™©ì— ë”°ë¼ êµ¬í˜„í•˜ê²Œ ëœë‹¤.
ì¼ë°˜ì ìœ¼ë¡œëŠ” ì„œë²„ì™€ ë¸Œë¼ìš°ì €ê°„ ì–‘ë°©í–¥ ë©”ì‹œì§€ ì „ë‹¬ì´ í•„ìš”í•˜ê¸° ë•Œë¬¸ì—, WebSocketë“±ì„ ì´ìš©í•´ì„œ êµ¬í˜„í•œë‹¤.</p>

<p>ì´ ë‹¨ê³„ì—ì„œëŠ” Socket.ioë¥¼ ì‚¬ìš©í•˜ì—¬ í´ë¼ì´ì–¸íŠ¸ë¼ë¦¬ ë©”ì‹œì§€ë¥¼ ìƒí˜¸ ì „ì†¡í•´ì£¼ëŠ” ë‹¨ìˆœí•œ Node.js ì„œë²„ì™€, 
ê·¸ì— ìƒì‘í•˜ëŠ” <code class="language-plaintext highlighter-rouge">onMessage</code>, <code class="language-plaintext highlighter-rouge">sendMessage</code> ë©”ì†Œë“œë¥¼ ë¸Œë¼ìš°ì €ë‹¨ì— êµ¬í˜„í•  ê²ƒì´ë‹¤.</p>

<p>í”„ë¡œì íŠ¸ root directoryì—ì„œ ë‹¤ìŒ ì»¤ë§¨ë“œë¥¼ ì‹¤í–‰í•˜ì—¬ npm socket.io packageë¥¼ ì„¤ì¹˜í•˜ê³  <code class="language-plaintext highlighter-rouge">server/index.js</code> íŒŒì¼ì„ ì‘ì„±í•œë‹¤.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm init
npm <span class="nb">install </span>socket.io node-static
</code></pre></div></div>

<p><strong>directory</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/  
â”œ package.json
â”‚
â”œ server/
â”‚â””index.js
â”‚
â”” client/
  â”œmessage.js
  â”œ ...
</code></pre></div></div>

<p><strong>server/index.js</strong> <a id="server-final-code"></a></p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="kd">static</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">node-static</span><span class="dl">'</span><span class="p">);</span> 
<span class="kd">const</span> <span class="nx">http</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">http</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">socketIO</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">socket.io</span><span class="dl">'</span><span class="p">);</span>

<span class="c1">// client íŒŒì¼ë“¤ì„ ê°™ì€ ì„œë²„ì—ì„œ ì„œë¹™í•œë‹¤.</span>
<span class="kd">const</span> <span class="nx">file</span> <span class="o">=</span> <span class="k">new</span> <span class="kd">static</span><span class="p">.</span><span class="nx">Server</span><span class="p">(</span><span class="dl">'</span><span class="s1">../client</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">http</span>
  <span class="p">.</span><span class="nx">createServer</span><span class="p">(</span><span class="nx">file</span><span class="p">.</span><span class="nx">serve</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">file</span><span class="p">))</span>
  <span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">3000</span><span class="p">);</span>

<span class="c1">// ëª¨ë“  í´ë¼ì´ì–¸íŠ¸ì—ì„œ ë°œì†¡ëœ ë©”ì‹œì§€ë¥¼ ë‹¤ë¥¸ ëª¨ë“  í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ë¬´ì°¨ë³„ì ìœ¼ë¡œ ì „ì†¡í•œë‹¤.</span>
<span class="nx">socketIO</span>
  <span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">app</span><span class="p">).</span><span class="nx">sockets</span>
  <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">connection</span><span class="dl">'</span><span class="p">,</span> <span class="nx">socket</span> <span class="o">=&gt;</span> <span class="p">(</span>
    <span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">message</span><span class="dl">'</span><span class="p">,</span> <span class="nx">message</span> <span class="o">=&gt;</span> <span class="nx">socket</span><span class="p">.</span><span class="nx">broadcast</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="dl">'</span><span class="s1">message</span><span class="dl">'</span><span class="p">,</span> <span class="nx">message</span><span class="p">))</span>
  <span class="p">));</span>
</code></pre></div></div>

<p><strong>caller.html</strong>, <strong>callee.html</strong></p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">&lt;!--body ë§¨ í•˜ë‹¨--&gt;</span>
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"/socket.io/socket.io.js"</span><span class="nt">&gt;&lt;/script&gt;</span> <span class="c">&lt;!--ì„œë²„ì¸¡ socket.ioì—ì„œ ì„œë¹™ë˜ëŠ” socket.io.jsë¥¼ ì¶”ê°€--&gt;</span>
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"caller(ë˜ëŠ” callee).js"</span> <span class="na">type=</span><span class="s">"module"</span><span class="nt">&gt;&lt;/script&gt;</span> <span class="c">&lt;!--type="module" ì¶”ê°€--&gt;</span>
</code></pre></div></div>

<p>ì´ì œë¶€í„° ìœ„ì—ì„œ ì‘ì„±í•œ ì›¹ì„œë²„ë¥¼ í†µí•´ì„œ ì ‘ê·¼í•  ê²ƒì´ê¸° ë•Œë¬¸ì— es6 module importë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. <br />
htmlíŒŒì¼ë“¤ì— <code class="language-plaintext highlighter-rouge">socket.io.js</code> ì˜ì¡´ì„±ì„ ì¶”ê°€í•´ì£¼ê³ , module importë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œ <code class="language-plaintext highlighter-rouge">type="module"</code>ë¥¼ ì¶”ê°€í•´ì¤€ë‹¤.</p>

<p><strong>client/message.js</strong> ë¥¼ ì¶”ê°€í•˜ê³  <code class="language-plaintext highlighter-rouge">sendMessage</code>, <code class="language-plaintext highlighter-rouge">onMessage</code> êµ¬í˜„</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">socket</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">io</span><span class="p">();</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">sendMessage</span> <span class="o">=</span> <span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">payload</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">socket</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="dl">'</span><span class="s1">message</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span><span class="nx">type</span><span class="p">,</span> <span class="nx">payload</span><span class="p">});</span>
<span class="k">export</span> <span class="kd">const</span> <span class="nx">onMessage</span> <span class="o">=</span> <span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">message</span><span class="dl">'</span><span class="p">,</span> <span class="nx">message</span> <span class="o">=&gt;</span> <span class="p">(</span>
  <span class="nx">message</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="nx">type</span> <span class="o">&amp;&amp;</span> <span class="nx">callback</span><span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">payload</span><span class="p">)</span>
<span class="p">));</span>
</code></pre></div></div>

<p><strong>client/caller.js</strong> ì— ì˜ì¡´ì„± ì¶”ê°€í•˜ê³  ë‚´ìš© ì •ë¦¬</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span><span class="nx">sendMessage</span><span class="p">,</span> <span class="nx">onMessage</span><span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./message.js</span><span class="dl">"</span><span class="p">;</span>  <span class="c1">// ì¶”ê°€</span>

<span class="p">(</span><span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">mediaStream</span> <span class="o">=</span> <span class="k">await</span> <span class="nb">navigator</span><span class="p">.</span><span class="nx">mediaDevices</span><span class="p">.</span><span class="nx">getUserMedia</span><span class="p">({</span> <span class="na">video</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="na">audio</span><span class="p">:</span> <span class="kc">false</span> <span class="p">});</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">localVideo</span><span class="dl">'</span><span class="p">).</span><span class="nx">srcObject</span> <span class="o">=</span> <span class="nx">mediaStream</span><span class="p">;</span>

  <span class="kd">const</span> <span class="nx">rtcPeerConnection</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">RTCPeerConnection</span><span class="p">();</span>
  <span class="nx">mediaStream</span><span class="p">.</span><span class="nx">getTracks</span><span class="p">().</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">track</span> <span class="o">=&gt;</span> <span class="nx">rtcPeerConnection</span><span class="p">.</span><span class="nx">addTrack</span><span class="p">(</span><span class="nx">track</span><span class="p">));</span>

  <span class="nx">rtcPeerConnection</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">negotiationneeded</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">sdpOffer</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">rtcPeerConnection</span><span class="p">.</span><span class="nx">createOffer</span><span class="p">();</span>
    <span class="nx">rtcPeerConnection</span><span class="p">.</span><span class="nx">setLocalDescription</span><span class="p">(</span><span class="nx">sdpOffer</span><span class="p">);</span>
    <span class="nx">sendMessage</span><span class="p">(</span><span class="dl">'</span><span class="s1">SDP</span><span class="dl">'</span><span class="p">,</span> <span class="nx">sdpOffer</span><span class="p">)</span>
  <span class="p">});</span> 
  
  <span class="nx">onMessage</span><span class="p">(</span><span class="dl">'</span><span class="s1">SDP</span><span class="dl">'</span><span class="p">,</span> <span class="nx">sdpAnswer</span> <span class="o">=&gt;</span> <span class="nx">rtcPeerConnection</span><span class="p">.</span><span class="nx">setRemoteDescription</span><span class="p">(</span><span class="k">new</span> <span class="nx">RTCSessionDescription</span><span class="p">(</span><span class="nx">sdpAnswer</span><span class="p">)));</span>
 
  <span class="nx">rtcPeerConnection</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">track</span><span class="dl">'</span><span class="p">,</span> <span class="nx">e</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">remoteVideo</span><span class="dl">'</span><span class="p">).</span><span class="nx">srcObject</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MediaStream</span><span class="p">([</span><span class="nx">e</span><span class="p">.</span><span class="nx">track</span><span class="p">])</span>
  <span class="p">});</span>
<span class="p">})();</span>
</code></pre></div></div>

<p><strong>client/callee.js</strong> ì— ì˜ì¡´ì„± ì¶”ê°€í•˜ê³  ë‚´ìš© ì •ë¦¬</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span><span class="nx">sendMessage</span><span class="p">,</span> <span class="nx">onMessage</span><span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./message.js</span><span class="dl">"</span><span class="p">;</span>  <span class="c1">// ì¶”ê°€</span>

<span class="p">(</span><span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">mediaStream</span> <span class="o">=</span> <span class="k">await</span> <span class="nb">navigator</span><span class="p">.</span><span class="nx">mediaDevices</span><span class="p">.</span><span class="nx">getUserMedia</span><span class="p">({</span> <span class="na">video</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="na">audio</span><span class="p">:</span> <span class="kc">false</span> <span class="p">});</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">localVideo</span><span class="dl">'</span><span class="p">).</span><span class="nx">srcObject</span> <span class="o">=</span> <span class="nx">mediaStream</span><span class="p">;</span>

  <span class="kd">const</span> <span class="nx">rtcPeerConnection</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">RTCPeerConnection</span><span class="p">();</span>
  <span class="nx">mediaStream</span><span class="p">.</span><span class="nx">getTracks</span><span class="p">().</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">track</span> <span class="o">=&gt;</span> <span class="nx">rtcPeerConnection</span><span class="p">.</span><span class="nx">addTrack</span><span class="p">(</span><span class="nx">track</span><span class="p">));</span>

  <span class="nx">onMessage</span><span class="p">(</span><span class="dl">'</span><span class="s1">SDP</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="nx">sdpOffer</span> <span class="o">=&gt;</span> <span class="p">{</span>    
    <span class="k">await</span> <span class="nx">rtcPeerConnection</span><span class="p">.</span><span class="nx">setRemoteDescription</span><span class="p">(</span><span class="k">new</span> <span class="nx">RTCSessionDescription</span><span class="p">(</span><span class="nx">sdpOffer</span><span class="p">));</span> 
    <span class="kd">const</span> <span class="nx">sdpAnswer</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">rtcPeerConnection</span><span class="p">.</span><span class="nx">createAnswer</span><span class="p">();</span>
    <span class="k">await</span> <span class="nx">rtcPeerConnection</span><span class="p">.</span><span class="nx">setLocalDescription</span><span class="p">(</span><span class="nx">sdpAnswer</span><span class="p">);</span>
    <span class="nx">sendMessage</span><span class="p">(</span><span class="dl">'</span><span class="s1">SDP</span><span class="dl">'</span><span class="p">,</span> <span class="nx">sdpAnswer</span><span class="p">);</span>
  <span class="p">});</span>
  
  <span class="nx">rtcPeerConnection</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">track</span><span class="dl">'</span><span class="p">,</span> <span class="nx">e</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">remoteVideo</span><span class="dl">'</span><span class="p">).</span><span class="nx">srcObject</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MediaStream</span><span class="p">([</span><span class="nx">e</span><span class="p">.</span><span class="nx">track</span><span class="p">])</span>
  <span class="p">});</span>
<span class="p">})();</span>
</code></pre></div></div>

<p>ì—¬ê¸°ê¹Œì§€ êµ¬í˜„ì„ ë§ˆì¹˜ê³  <code class="language-plaintext highlighter-rouge">node server</code> ë¡œ ì›¹ì„œë²„ë¥¼ êµ¬ë™ì‹œí‚¤ë©´ 
<a href="http://localhost:3000/caller.html">http://localhost:3000/caller.html</a>,
<a href="http://localhost:3000/callee.html">http://localhost:3000/callee.html</a> ë¡œ ê°ê° ì ‘ì† ê°€ëŠ¥í•˜ë‹¤.</p>

<p>ê° íƒ­ì˜ ê°œë°œì ë„êµ¬ì˜ ë„¤íŠ¸ì›Œí¬ íƒ­ì„ ë³´ë©´
Signaling Serverì˜ WebSocketì„ í†µí•´ì„œ ì„œë¡œ SDPë¥¼ êµí™˜í•˜ëŠ” ë‚´ìš©ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</p>

<p><img src="https://user-images.githubusercontent.com/4980032/94692526-93beb680-036d-11eb-832e-4434958b0d03.png" alt="" /></p>

<p>ë¸Œë¼ìš°ì €ê°€ í¬ë¡¬ì¸ ê²½ìš°, <a href="chrome://webrtc-internals/">chrome://webrtc-internals/</a> ì— ì ‘ì†í•´ë³´ë©´
webrtc ê´€ë ¨í•œ ë„¤íŠ¸ì›Œí¬ ìƒíƒœì™€ ì´ë²¤íŠ¸ ë°œìƒì„ ëª¨ë‹ˆí„° í•  ìˆ˜ ìˆëŠ”ë°, ë§ˆì§€ë§‰ìœ¼ë¡œ ë°œìƒí•œ <code class="language-plaintext highlighter-rouge">signalingstatechange</code> ì´ë²¤íŠ¸ë¥¼ ì‚´í´ë³´ë©´
ì–‘ì¸¡ì—ì„œ ìƒíƒœê°€ <code class="language-plaintext highlighter-rouge">stable</code>ë¡œ ë³€ê²½ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.</p>

<h4 id="ï¸ì£¼ì˜ì‚¬í•­">âš ï¸ì£¼ì˜ì‚¬í•­</h4>

<p>ì§€ê¸ˆ êµ¬í˜„í•˜ëŠ” signaling serverëŠ” ì ‘ì†ì ì‹ë³„ê¸°ëŠ¥ì´ ì—†ê¸° ë•Œë¬¸ì— ëª¨ë“  ë©”ì‹œì§€ë¥¼ broadcastingí•œë‹¤. ë¡œì»¬ì—ì„œ í…ŒìŠ¤íŠ¸ì‹œ 
caller, callee ê°ê° í•œê°œì”© ì´ìƒì˜ ë¸Œë¼ìš°ì €ë¥¼ ë„ìš¸ ê²½ìš°, ê°ê°ì˜ ì—°ê²° ìƒíƒœì™€ ë©”ì‹œì§€ê°€ ì¼ì¹˜í•˜ì§€ ì•Šì•„ ì •ìƒì ìœ¼ë¡œ ì‘ë™ì´ ë¶ˆê°€ëŠ¥í•˜ë‹¤.</p>

<h2 id="rtc-ì—°ê²°-ìƒì„±í•˜ê¸°-2">RTC ì—°ê²° ìƒì„±í•˜ê¸° (2)</h2>

<p>ì´ì œ Signaling Serverê¹Œì§€ êµ¬í˜„ì´ ì™„ë£Œë˜ì—ˆë‹¤! ê·¸ëŸ¬ë©´ ì´ì œ ë‘ê°œì˜ ë¸Œë¼ìš°ì €ì— ê°ê°
<a href="http://localhost:3000/caller.html">caller App</a> ê³¼ <a href="http://localhost:3000/callee.html">callee App</a> ì„ ë„ìš°ê³  
ì„œë¡œ ì „ì†¡ë˜ëŠ” ë‘ê°œì˜ í™”ë©´ì„ ë³¼ìˆ˜ ìˆëŠ” ê²ƒì¼ê¹Œ?!</p>

<p>ì‹¤ì œ ì‹¤í–‰í•´ë³´ë©´ ì•„ì§ local videoë§Œ ë‚˜ì˜¤ê³  remote videoëŠ” ë‚˜ì˜¤ì§€ ì•ŠëŠ”ë‹¤.
<a href="#rtc-ì—°ê²°-ìƒì„±í•˜ê¸°-1">RTC ì—°ê²° ìƒì„±í•˜ê¸° (1)</a> ì—ì„œ ì–¸ê¸‰í•œ ê²ƒ ì²˜ëŸ¼ ì‹¤ì œ ì—°ê²°ì´ ì´ë£¨ì–´ì§€ê³  í†µì‹ ì„ í•˜ê¸° ìœ„í•´ì„œëŠ” SDPì™€ ICE ë‘ê°€ì§€ ì •ë³´ê°€ êµí™˜ë˜ì–´ì•¼ í•˜ëŠ”ë°
ì•„ì§ ì–´ë–¤ í˜•ì‹ìœ¼ë¡œ ë°ì´í„°ë¥¼ ì£¼ê³  ë°›ì„ì§€ì— ëŒ€í•œ ì •ë³´ë¥¼ ë‹´ê³  ìˆëŠ” <strong>(ICE - Interactive Connectivity Establishment)</strong> ë¥¼ 
êµí™˜í•˜ëŠ” ë‹¨ê³„ì— ëŒ€í•œ êµ¬í˜„ì´ ì´ë£¨ì–´ ì§€ì§€ ì•Šì•˜ë‹¤.</p>

<p>ë°ì´í„°ë¥¼ ì£¼ê³ ë°›ëŠ” í˜•ì‹ì€ ë¯¸ë””ì–´ íƒ€ì…ì´ë‚˜ ë¸Œë¼ìš°ì € ìƒí™©ì— ë”°ë¼ í•œê°€ì§€ ì´ìƒì˜ ë°©ì‹ìœ¼ë¡œ í†µì‹ ì´ ê°€ëŠ¥í•˜ê¸°ë•Œë¬¸ì— 
ICE candidatesë¼ê³  ë¶ˆë¦¬ëŠ” ì—¬ëŸ¬ê°œì˜ í›„ë³´êµ°ì„ ì£¼ê³  ë°›ê³ , ì´ì¤‘ì—ì„œ ì„œë¡œ ê°€ëŠ¥í•œ ë°©ì‹ì´ ìˆì„ë•Œ ìµœì ì´ë¼ê³  íŒë‹¨ë˜ëŠ” ICEë¥¼
ê³¨ë¼ì„œ í˜‘ì˜í•˜ê²Œ ëœë‹¤.</p>

<p>ì´ ì„ íƒê³¼ì •ì€ í‘œì¤€ì— ì˜í•´ êµ¬í˜„ëœ ë¸Œë¼ìš°ì €ê°€ ì‹¤í–‰í•˜ê²Œ ë˜ë¯€ë¡œ ìš°ë¦¬ëŠ” ìœ„ì—ì„œ êµ¬ì¶•í•œ Signaling Serverë¥¼ í†µí•´ì„œ
ICE candidatesë¥¼ ì„œë¡œ ì „ë‹¬í•´ì£¼ê¸°ë§Œ í•˜ë©´ ëœë‹¤.</p>

<h3 id="ice-êµí™˜-ë‹¨ê³„">ICE êµí™˜ ë‹¨ê³„</h3>

<p><code class="language-plaintext highlighter-rouge">rtcPeerConnection.setLocalDescription</code>ë¥¼ í˜¸ì¶œí•œ ì‹œì  ì´í›„ë¡œë¶€í„° ê° <code class="language-plaintext highlighter-rouge">rtcPeerConnection</code>ê°ì²´ëŠ” ICE candidate ë¥¼ ìƒì„±í•  ìˆ˜ ìˆê³ 
ê·¸ë•Œë§ˆë‹¤ <code class="language-plaintext highlighter-rouge">icecandidate</code>ì´ë²¤íŠ¸ë¥¼ ë°œìƒì‹œí‚¨ë‹¤. ì´ ì´ë²¤íŠ¸ ê°ì²´ì— ICE candidate ì •ë³´ê°€ ë“¤ì–´ìˆìœ¼ë¯€ë¡œ ì´ë¥¼ ìƒëŒ€í¸ì—ê²Œ ë©”ì‹œì§€ë¡œ
ì „ë‹¬í•˜ê³ , ë˜ ë©”ì‹œì§€ê°€ ë“¤ì–´ì˜¤ë©´ <code class="language-plaintext highlighter-rouge">rtcPeerConnection.addIceCandidate</code> ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•˜ì—¬ ìƒëŒ€í¸ì—ì„œ ë³´ë‚´ì˜¨ ICE candidateë¥¼
ë¡œì»¬ rtcPeerConnectionì— ë“±ë¡í•˜ë©´ ëœë‹¤.</p>

<p><strong>caller.js</strong>, <strong>callee.js</strong> ë™ì¼í•˜ê²Œ</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/*...ì•ì˜ ì½”ë“œ ë‚´ìš©ì— ì´ì–´ì„œ...*/</span>

<span class="c1">// ì‹¤ì œ ë¡œê·¸ë¥¼ ì°ì–´ë³´ë©´ ì´ë²¤íŠ¸ëŠ” ì´ ì„¸ë²ˆ ë°œìƒí•˜ëŠ”ë°, </span>
<span class="c1">// ê°ê° TCP, UDP í”„ë¡œí† ì½œ ì—°ê²°ì— ëŒ€í•œ ICEê°€ ìƒì„±ë˜ê³ </span>
<span class="c1">// ë§ˆì§€ë§‰ìœ¼ë¡œ ICE candidateì˜ ëì„ ë‚˜íƒ€ë‚´ëŠ” nullê°’ì´ ì „ë‹¬ëœë‹¤.</span>
<span class="nx">rtcPeerConnection</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">icecandidate</span><span class="dl">'</span><span class="p">,</span> <span class="nx">e</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">candidate</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
    <span class="nx">sendMessage</span><span class="p">(</span><span class="dl">'</span><span class="s1">ICE</span><span class="dl">'</span><span class="p">,</span> <span class="nx">e</span><span class="p">.</span><span class="nx">candidate</span><span class="p">)</span>  
<span class="p">});</span>

<span class="nx">onMessage</span><span class="p">(</span><span class="dl">'</span><span class="s1">ICE</span><span class="dl">'</span><span class="p">,</span> <span class="nx">iceCandidate</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">rtcPeerConnection</span><span class="p">.</span><span class="nx">addIceCandidate</span><span class="p">(</span><span class="k">new</span> <span class="nx">RTCIceCandidate</span><span class="p">(</span><span class="nx">iceCandidate</span><span class="p">));</span>
<span class="p">})</span>
</code></pre></div></div>

<p>ì—¬ê¸°ê¹Œì§€ ìˆ˜í–‰í•˜ë©´ ë‘ê°œì˜ ë¸Œë¼ìš°ì €ì— ê°ê° local, remote í™”ë©´ì´ ì¶œë ¥ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìœ¼ë©°, 
ì„œë¡œ ë‹¤ë¥¸ í”„ë¡œì„¸ìŠ¤ ì‚¬ì´ì—ì„œ ì‹œê·¸ë„ ì„œë²„ë¥¼ í†µí•˜ì§€ ì•Šê³  ì§ì ‘ ë„¤íŠ¸ì›Œí¬ë¥¼ í†µí•´ í†µì‹ í•˜ì—¬ ë¹„ë””ì˜¤ ìŠ¤íŠ¸ë¦¼ì„ ì „ì†¡í•˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
ì‹¤ì œ ì „ì†¡ë˜ëŠ” ë°ì´í„°ì— ëŒ€í•œ ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ì„ <a href="chrome://webrtc-internals/">chrome://webrtc-internals/</a>ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
ë‹¤ë§Œ í˜„ì¬ê¹Œì§€ëŠ” í•˜ë‚˜ì˜ ì»´í“¨í„°ì—ì„œ ì‹¤í–‰í•˜ê³  ìˆê¸° ë•Œë¬¸ì— local ë¹„ë””ì˜¤ë‚˜ remote ë¹„ë””ì˜¤ë‚˜ ê°™ì€ í™”ë©´ì´ ë³´ì¼í…ë° 
ë„¤íŠ¸ì›Œí¬ë¥¼ í†µí•˜ê¸° ë•Œë¬¸ì— ìì„¸íˆ ë³´ë©´ ë¯¸ì„¸í•œ ë ˆì´í„´ì‹œê°€ ë°œìƒí•˜ëŠ”ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤.</p>

<p>ì—¬ê¸°ê¹Œì§€ì˜ í†µì‹ ê³¼ì •ì„ ì‹œí€€ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨ìœ¼ë¡œ ì •ë¦¬í•˜ë©´ ì•„ë˜ì™€ ê°™ë‹¤.</p>

<div class="mermaid"> 
sequenceDiagram
Participant caller
Participant signal server
Participant callee
par
caller-&gt;&gt;caller: createOffer()
Note left of caller: LocalDescription = offer
caller-&gt;&gt;signal server: offerSDP
signal server-&gt;&gt;callee: offerSDP
Note right of callee: RemoteDescription = offer
callee-&gt;&gt;callee: createAnswer()
Note right of callee: LocalDescription = answer
callee--&gt;&gt;signal server: answerSDP
signal server--&gt;&gt;caller: answerSDP
Note left of caller: RemoteDescription = answer
and
callee-&gt;&gt;signal server: IceCandidate(callee) x N
signal server-&gt;&gt;caller: IceCandidate(callee) x N
Note left of caller: IceCandidates = iceCandidate(callee) x N
and
caller-&gt;&gt;signal server: IceCandidate(caller) x N
signal server-&gt;&gt;callee: IceCandidate(caller) x N
Note right of callee: IceCandidates = iceCandidate(caller) x N
end

Note over caller, callee: negotiation end

caller-&gt;&gt;callee: p2p Media streaming(Audio, Video, Data)
callee-&gt;&gt;caller: p2p Media streaming(Audio, Video, Data)
</div>

<h2 id="caller-callee-ì½”ë“œ-í†µí•©-ë°-ì •ë¦¬">Caller, Callee ì½”ë“œ í†µí•© ë° ì •ë¦¬</h2>

<p>ì—¬íƒœê¹Œì§€ ë¡œì§ êµ¬ë¶„ì„ ê°„ë‹¨íˆ í•˜ê¸° ìœ„í•´ <code class="language-plaintext highlighter-rouge">Caller</code>, <code class="language-plaintext highlighter-rouge">Callee</code>ë¥¼ êµ¬ë¶„í•´ì„œ ì‘ì„±í–ˆì§€ë§Œ, 
ì‹¤ì œ ì‚¬ìš©ì‹œì—ëŠ” ë‘ ì—­í• ì— ë”°ë¼ ì—”ë“œí¬ì¸íŠ¸ê°€ êµ¬ë¶„ë˜ì–´ ìˆì§€ ì•ŠëŠ” ê²½ìš°ê°€ ë§ê³ , ë¡œì§ë„ ì¤‘ë³µëœ ë¶€ë¶„ì´ ë§ì•„ì„œ ì ë‹¹í•œ UIì™€ í•¨ê»˜
í•˜ë‚˜ì˜ Appìœ¼ë¡œ í†µí•©í•´ë„ ë¬´ë¦¬ê°€ ì—†ë‹¤.</p>

<p>ë‘ ë¶€ë¶„ì„ í•˜ë‚˜ë¡œ í†µí•©í•˜ê³  ì¤‘ë³µëœ ë¶€ë¶„ì„ ì •ë¦¬í•œ ê²°ê³¼ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.</p>

<p><strong>index.html</strong></p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!doctype html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"ko"</span><span class="nt">&gt;</span>
<span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"UTF-8"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;title&gt;</span>WebRTC<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;h1&gt;</span>í™”ìƒí†µí™”<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;h2&gt;</span>ë‚´ í™”ë©´<span class="nt">&lt;/h2&gt;</span>
    <span class="nt">&lt;video</span> <span class="na">id=</span><span class="s">"localVideo"</span> <span class="na">autoplay</span> <span class="na">width=</span><span class="s">"480px"</span><span class="nt">&gt;&lt;/video&gt;</span>
    <span class="nt">&lt;h2&gt;</span>ìƒëŒ€ë°© í™”ë©´<span class="nt">&lt;/h2&gt;</span>
    <span class="nt">&lt;video</span> <span class="na">id=</span><span class="s">"remoteVideo"</span> <span class="na">autoplay</span> <span class="na">width=</span><span class="s">"480px"</span><span class="nt">&gt;&lt;/video&gt;</span>
    <span class="nt">&lt;button</span> <span class="na">id=</span><span class="s">"call"</span><span class="nt">&gt;</span>ğŸ“CALL<span class="nt">&lt;/button&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"/socket.io/socket.io.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"script.js"</span> <span class="na">type=</span><span class="s">"module"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>

<p><strong>script.js</strong></p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span><span class="nx">onMessage</span><span class="p">,</span> <span class="nx">sendMessage</span><span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./message.js</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">callButton</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">call</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">localVideo</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">localVideo</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">remoteVideo</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">remoteVideo</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">rtcPeerConnection</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">RTCPeerConnection</span><span class="p">();</span>

<span class="kd">const</span> <span class="nx">sendSdpOffer</span> <span class="o">=</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">rtcSessionDescriptionInit</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">rtcPeerConnection</span><span class="p">.</span><span class="nx">createOffer</span><span class="p">();</span>
  <span class="k">await</span> <span class="nx">rtcPeerConnection</span><span class="p">.</span><span class="nx">setLocalDescription</span><span class="p">(</span><span class="nx">rtcSessionDescriptionInit</span><span class="p">);</span>
  <span class="nx">sendMessage</span><span class="p">(</span><span class="dl">'</span><span class="s1">SDP</span><span class="dl">'</span><span class="p">,</span> <span class="nx">rtcSessionDescriptionInit</span><span class="p">)</span>
<span class="p">};</span>

<span class="kd">const</span> <span class="nx">sendSdpAnswer</span> <span class="o">=</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">rtcSessionDescriptionInit</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">rtcPeerConnection</span><span class="p">.</span><span class="nx">createAnswer</span><span class="p">();</span>
  <span class="k">await</span> <span class="nx">rtcPeerConnection</span><span class="p">.</span><span class="nx">setLocalDescription</span><span class="p">(</span><span class="nx">rtcSessionDescriptionInit</span><span class="p">);</span>
  <span class="nx">sendMessage</span><span class="p">(</span><span class="dl">'</span><span class="s1">SDP</span><span class="dl">'</span><span class="p">,</span> <span class="nx">rtcSessionDescriptionInit</span><span class="p">);</span>
<span class="p">};</span>

<span class="nb">navigator</span><span class="p">.</span><span class="nx">mediaDevices</span>
  <span class="p">.</span><span class="nx">getUserMedia</span><span class="p">({</span><span class="na">video</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="na">audio</span><span class="p">:</span> <span class="kc">false</span><span class="p">})</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">mediaStream</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">localVideo</span><span class="p">.</span><span class="nx">srcObject</span> <span class="o">=</span> <span class="nx">mediaStream</span><span class="p">;</span>
    <span class="nx">mediaStream</span><span class="p">.</span><span class="nx">getTracks</span><span class="p">().</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">track</span> <span class="o">=&gt;</span> <span class="nx">rtcPeerConnection</span><span class="p">.</span><span class="nx">addTrack</span><span class="p">(</span><span class="nx">track</span><span class="p">));</span>
  <span class="p">});</span>

<span class="c1">// exchange SDP</span>
<span class="nx">rtcPeerConnection</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">negotiationneeded</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">callButton</span><span class="p">.</span><span class="nx">disabled</span> <span class="o">=</span> <span class="kc">false</span><span class="p">)</span>
<span class="nx">callButton</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">click</span><span class="dl">'</span><span class="p">,</span> <span class="nx">sendSdpOffer</span><span class="p">)</span>
<span class="nx">onMessage</span><span class="p">(</span><span class="dl">'</span><span class="s1">SDP</span><span class="dl">'</span><span class="p">,</span> <span class="k">async</span> <span class="nx">descriptionInit</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">rtcSessionDescription</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">RTCSessionDescription</span><span class="p">(</span><span class="nx">descriptionInit</span><span class="p">);</span>
  <span class="k">await</span> <span class="nx">rtcPeerConnection</span><span class="p">.</span><span class="nx">setRemoteDescription</span><span class="p">(</span><span class="nx">rtcSessionDescription</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">descriptionInit</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">offer</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">callButton</span><span class="p">.</span><span class="nx">disabled</span> <span class="o">=</span> <span class="kc">true</span>
    <span class="k">await</span> <span class="nx">sendSdpAnswer</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">})</span>

<span class="c1">// exchange ICE</span>
<span class="nx">rtcPeerConnection</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">icecandidate</span><span class="dl">'</span><span class="p">,</span> <span class="nx">e</span> <span class="o">=&gt;</span> <span class="nx">e</span><span class="p">.</span><span class="nx">candidate</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="nx">sendMessage</span><span class="p">(</span><span class="dl">'</span><span class="s1">ICE</span><span class="dl">'</span><span class="p">,</span> <span class="nx">e</span><span class="p">.</span><span class="nx">candidate</span><span class="p">));</span>
<span class="nx">onMessage</span><span class="p">(</span><span class="dl">'</span><span class="s1">ICE</span><span class="dl">'</span><span class="p">,</span> <span class="nx">candidateInit</span> <span class="o">=&gt;</span> <span class="nx">rtcPeerConnection</span><span class="p">.</span><span class="nx">addIceCandidate</span><span class="p">(</span><span class="k">new</span> <span class="nx">RTCIceCandidate</span><span class="p">(</span><span class="nx">candidateInit</span><span class="p">)))</span>

<span class="c1">// handle remote stream</span>
<span class="nx">rtcPeerConnection</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">track</span><span class="dl">'</span><span class="p">,</span> <span class="nx">e</span> <span class="o">=&gt;</span> <span class="nx">remoteVideo</span><span class="p">.</span><span class="nx">srcObject</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MediaStream</span><span class="p">([</span><span class="nx">e</span><span class="p">.</span><span class="nx">track</span><span class="p">]));</span>
</code></pre></div></div>

<p>ìœ„ì—ì„œ ì–¸ê¸‰í•œê²ƒê³¼ ê°™ì´ ì‹œê·¸ë„ë§ ì„œë²„ êµ¬í˜„ì´ ìµœì†Œí•œì˜ êµ¬í˜„ìœ¼ë¡œ ë˜ì–´ìˆê¸° ë•Œë¬¸ì—
ì‹¤ì œë¡œ 1:1 í™”ìƒì±„íŒ…ì„ ì„œë¹„ìŠ¤ í•˜ê¸°ì—ëŠ” ì•„ì§ ë¬´ë¦¬ê°€ ìˆì§€ë§Œ ë¸Œë¼ìš°ì €ì˜ ì„œë¡œ ë‹¤ë¥¸ íƒ­ì— ë‘ê°œì˜ í™”ë©´ì„ ë„ì›Œë³´ë©´ ì„œë¡œ í†µì‹ í•˜ëŠ” ê²ƒì„ í™•ì¸í• ìˆ˜ ìˆë‹¤.</p>

<p>ì´ì œ ë˜‘ê°™ì€ í™”ë©´ì´ ë‘ê°œì”© ë‚˜ì˜¤ëŠ” ê²ƒì€ ì‹¤ì»· ë´¤ìœ¼ë‹ˆ ì‹¤ì œ ë‹¤ë¥¸ ë””ë°”ì´ìŠ¤ì—ì„œ í™”ë©´ì„ ë³´ë©° í™•ì¸í•´ë³´ê³  ì‹¶ë‹¤.
ë‹¤ìŒ ì»¤ë§¨ë“œë¥¼ í„°ë¯¸ë„ì— ì…ë ¥í•˜ì—¬ ë¡œì»¬ ipë¥¼ ì•Œì•„ë‚¸ ë‹¤ìŒ ê°™ì€ ì™€ì´íŒŒì´ ë§ì— ì ‘ì†ëœ ëª¨ë°”ì¼ ê¸°ê¸°ë¡œ ì ‘ì†í•´ë³´ì.(mac ê¸°ì¤€)</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> ifconfig | <span class="nb">grep </span>192 <span class="c">#192.168.0.6 -&gt; http://192.168.0.6:3000 </span>
</code></pre></div></div>

<p>ì•„ë§ˆ ì œëŒ€ë¡œ ì‘ë™ì´ ì•ˆë  ê²ƒì´ë‹¤. userMediaë¥¼ ê°€ì ¸ì˜¬ë•Œ localhost ì´ì™¸ì˜ ì£¼ì†Œì—ì„œëŠ” httpsë¡œ ì ‘ì†ì´ ìš”êµ¬ëœë‹¤. ê·¸ë ‡ì§€ ì•Šìœ¼ë©´
ê´€ë ¨ APIê°€ ì‘ë™í•˜ì§€ ì•ŠëŠ”ë‹¤. ê·¸ ì™¸ì—ë„ ëª¨ë°”ì¼ ê¸°ê¸° ì ‘ì†ì„ í†µí•´ p2p ë¹„ë””ì˜¤ìŠ¤íŠ¸ë¦¬ë°ì„ ì •ìƒ êµ¬ë™í•˜ë ¤ë©´ í•´ì•¼í•  ì¼ë“¤ì´ ëª‡ê°€ì§€ ë” ìˆëŠ”ë°,<br />
ê·¸ê²ƒì€ ë‹¤ìŒ í¬ìŠ¤íŒ…ì—ì„œ ì´ì–´ì„œ ë‹¤ë£°ê²ƒì´ë‹¤.</p>

<p>ì—¬ê¸°ê¹Œì§€ ì‘ì„±í•œ ì½”ë“œëŠ” ì•„ë˜ repoì— ì—…ë¡œë“œ ë˜ì–´ ìˆë‹¤.<br />
<a href="https://github.com/neocjmix/WebRTC/tree/p2p-%ED%99%94%EC%83%81%EC%B1%84%ED%8C%85-%EA%B5%AC%ED%98%84-(1)">https://github.com/neocjmix/WebRTC/tree/p2p-í™”ìƒì±„íŒ…-êµ¬í˜„-(1)</a></p>
:ET