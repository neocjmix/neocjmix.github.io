I"g<h2 id="html-form">HTML Form</h2>

<p>ì¼ë°˜ì ì¸ formì—ì„œ input[type=â€fileâ€]ì„ ì¶”ê°€í•˜ê³ , post ë¡œ ì „ì†¡í•˜ë©´ íŒŒì¼ì´ ë°”ì´ë„ˆë¦¬ë¡œ ì „ì†¡ëœë‹¤. ì´ë•Œ ì¼ë°˜ì ì¸ í¼ ë°ì´í„°ê°€ ì•„ë‹Œ ë°”ì´ë„ˆë¦¬ íŒŒì¼ì„ ì „ì†¡í•˜ê¸° ìœ„í•´ì„œëŠ” <code class="language-plaintext highlighter-rouge">enctype</code> attibuteë¥¼ ì„¤ì •í•´ ì£¼ì–´ì•¼ í•œë‹¤.</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"ì „ì†¡í•  ì£¼ì†Œ"</span> <span class="na">method=</span><span class="s">"post"</span> <span class="na">enctype=</span><span class="s">"multipart/form-data"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"testField"</span> <span class="na">value=</span><span class="s">"testValue"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">name=</span><span class="s">"file"</span> <span class="na">type=</span><span class="s">"file"</span> <span class="na">multiple=</span><span class="s">"true"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">enctype</code> attribute ëŠ” ì „ì†¡ë  dataì˜ MIME íƒ€ì…ì„ ì„¤ì •í•œë‹¤. ì´ ê°’ì€ http headerì˜ Content-Type í•„ë“œë¥¼ í†µí•´ì„œ ì„œë²„ì¸¡ì— ì „ë‹¬ëœë‹¤.</p>

<p>HTML formì€ í•´ë‹¹ ê°’ì— ë”°ë¼ì„œ ë‹¤ìŒì˜ encodingì„ ì œê³µí•œë‹¤.</p>

<ul>
  <li>application/x-www-form-urlencoded (default)<br />
ëª¨ë“  ê³µë°±ê³¼ íŠ¹ìˆ˜ë¬¸ìë¥¼ ì¸ì½”ë”© í•œë‹¤.</li>
  <li>multipart/form-data<br />
ì•„ë¬´ ê¸€ìë„ ì¸ì½”ë”© ë˜ì§€ ì•ŠëŠ”ë‹¤. ì—¬ëŸ¬ê°œì˜ content typeì„ boundary stringìœ¼ë¡œ êµ¬ë¶„í•´ì„œ ë³´ë‚¼ ë•Œ ì‚¬ìš©ë˜ë©°, ì¼ë°˜ì ìœ¼ë¡œ binary íŒŒì¼ì´ í¬í•¨ëœ í¼ì„ ì „ì†¡í•  ë•Œ ì‚¬ìš©í•œë‹¤.</li>
  <li>text/plain<br />
ê³µë°±ë¬¸ìë§Œ ì¸ì½”ë”©í•œë‹¤.</li>
</ul>

<h3 id="http-ì „ì†¡ë‚´ìš©">HTTP ì „ì†¡ë‚´ìš©</h3>

<p>ì „ì†¡ì‹œ headerì™€ bodyì—ëŠ” ë‹¤ìŒ ë‚´ìš©ì´ í¬í•¨ëœë‹¤.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST ì „ì†¡ë  ì£¼ì†Œ
HTTP/1.1
Host: í˜¸ìŠ¤íŠ¸ ì´ë¦„
Content-Type: multipart/form-data<span class="p">;</span> <span class="nv">boundary</span><span class="o">=</span><span class="nt">------this-is-boundary</span> <span class="c">### ë°”ìš´ë”ë¦¬ ê²½ê³„ë¥¼ ë‚˜íƒ€ë‚¼ ë¬¸ìì—´. ë³´í†µ ë¸Œë¼ìš°ì €ì—ì„œ ì„ì˜ë¡œ ì •í•œë‹¤.### </span>
<span class="c">### ì—¬ê¸°ê¹Œì§€ í—¤ë”. ê³µë°± ì¤„ì„ ë„£ê³  bodyê°€ ì‹œì‘ëœë‹¤.### </span>

<span class="nt">------this-is-boundary</span> <span class="c">### Content-Typeì—ì„œ ì •í•œ ë°”ìš´ë”ë¦¬ ë¬¸ìë¡œ partì˜ ê²½ê³„ë¥¼ ë‚˜ëˆˆë‹¤.### </span>
Content-Disposition: form-data<span class="p">;</span> <span class="nv">name</span><span class="o">=</span><span class="s2">"testField"</span>

testValue
<span class="nt">------this-is-boundary</span>
Content-Disposition: form-data<span class="p">;</span> <span class="nv">name</span><span class="o">=</span><span class="s2">"file"</span><span class="p">;</span> <span class="nv">filename</span><span class="o">=</span><span class="s2">"sample.png"</span>
Content-Type: image/png

ë°”ì´ë„ˆë¦¬ ë°ì´í„°...
<span class="nt">------this-is-boundary--</span> <span class="c">### ë§ˆì§€ë§‰ì— "--"ê°€ ë¶™ì–´ì„œ ì „ì†¡ë‚´ìš©ì˜ ëì„ ì•Œë¦°ë‹¤.### </span>
</code></pre></div></div>

<h2 id="vanillajs">VanillaJS</h2>

<h3 id="íŒŒì¼-ì ‘ê·¼">íŒŒì¼ ì ‘ê·¼</h3>

<p>ì¼ë‹¨ js ëŠ” ë¡œì»¬ íŒŒì¼ ì‹œìŠ¤í…œì— ì§ì ‘ ì ‘ê·¼í•  ìˆ˜ ì—†ìœ¼ë¯€ë¡œ íŒŒì¼ì„ ì½ì–´ì„œ ë­˜ ì¢€ í•´ë³´ë ¤ë©´ html input element ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ í¸í•˜ë‹¤.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">fileInput</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">"</span><span class="s2">input</span><span class="dl">"</span><span class="p">);</span>
<span class="nx">fileInput</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">file</span><span class="dl">"</span><span class="p">;</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">fileInput</span><span class="p">);</span>
</code></pre></div></div>

<p>ì—¬ëŸ¬ íŒŒì¼ì„ ì„ íƒ ê°€ëŠ¥í•˜ê²Œ í•˜ë ¤ë©´ multiple ì†ì„±ì„ true ë¡œ í•´ì¤€ë‹¤.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">fileInput</span><span class="p">.</span><span class="nx">multiple</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</code></pre></div></div>

<p>ë¸Œë¼ìš°ì €ì—ì„œ ì‚¬ìš©ìê°€ íŒŒì¼ì„ ì„ íƒí•˜ë©´ í•´ë‹¹ ì •ë³´ê°€ element ê°ì²´ì— ë“¤ì–´ì˜¨ë‹¤. ê°ì²´ë¥¼ ì‚´í´ë³´ë©´ valueì—ëŠ” ë§ˆì§€ë§‰ ì¶”ê°€ëœ íŒŒì¼ì˜ ë³´ì•ˆìƒ ê°€ì§œ ê²½ë¡œê°€ ë“¤ì–´ìˆê³ , â€œfilesâ€ property ì— ë°°ì—´ í˜•ì‹ìœ¼ë¡œ íŒŒì¼ì´ ë“¤ì–´ìˆë‹¤. files[0]ì— íŒŒì¼ ì´ë¦„, í¬ê¸°, MIME íƒ€ì… ë“±ì´ ë“¤ì–´ìˆë‹¤.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">input</span> <span class="o">=</span> <span class="p">{</span>
	<span class="na">value</span> <span class="p">:</span> <span class="dl">"</span><span class="s2">fake/path/to/file</span><span class="dl">"</span>
	<span class="na">files</span> <span class="p">:</span> <span class="p">[</span><span class="nx">File</span><span class="p">,</span> <span class="nx">File</span><span class="p">,</span> <span class="nx">File</span><span class="p">,</span> <span class="nx">File</span><span class="p">]</span>
<span class="p">};</span>

<span class="nx">input</span><span class="p">.</span><span class="nx">files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
     <span class="na">lastModified</span><span class="p">:</span> <span class="mi">1446104232000</span><span class="p">,</span>
    <span class="na">lastModifiedDate</span><span class="p">:</span> <span class="nx">Thu</span> <span class="nx">Oct</span> <span class="mi">29</span> <span class="mi">2015</span> <span class="mi">16</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mi">12</span> <span class="nx">GMT</span><span class="o">+</span><span class="mi">0900</span> <span class="p">(</span><span class="nx">KST</span><span class="p">),</span>
    <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">filename.png</span><span class="dl">"</span><span class="p">,</span>
    <span class="na">size</span><span class="p">:</span> <span class="mi">9755</span><span class="p">,</span>
    <span class="na">type</span><span class="p">:</span> <span class="dl">"</span><span class="s2">image/png</span><span class="dl">"</span>
<span class="p">}</span>
</code></pre></div></div>

<p>ì´ File ì€ Blob ê°ì²´ë¥¼ í™•ì¥í•œ íƒ€ì…ì´ë‹¤.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">fileInput</span><span class="p">.</span><span class="nx">files</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">__proto__</span><span class="p">.</span><span class="nx">__proto__</span><span class="p">;</span> <span class="c1">//Blob</span>
</code></pre></div></div>

<p>Blob íƒ€ì…ì€ FileReaderë¥¼ í†µí•´ ì½ì–´ë“¤ì´ê±°ë‚˜ XMLHttpRequest ë¥¼ í†µí•´ ì „ì†¡í•  ìˆ˜ ìˆë‹¤.</p>

<h4 id="íŒŒì¼-ì½ê¸°">íŒŒì¼ ì½ê¸°</h4>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">fr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FileReader</span><span class="p">();</span>

<span class="c1">//ë¹„ë™ê¸°ë¡œ ì½ì–´ë“¤ì´ë¯€ë¡œ, ì½ê¸° ì™„ë£Œì‹œ callback ì§€ì •</span>
<span class="nx">fr</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">"</span><span class="s2">load</span><span class="dl">"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">result</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">fr</span><span class="p">.</span><span class="nx">readAsBinaryString</span><span class="p">(</span><span class="nx">fileInput</span><span class="p">.</span><span class="nx">files</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span> <span class="c1">//fr.result ì— stringìœ¼ë¡œ ë³€í™˜ëœ binaryê°€ ë“¤ì–´ì˜¨ë‹¤.</span>
</code></pre></div></div>

<h3 id="íŒŒì¼-ì „ì†¡">íŒŒì¼ ì „ì†¡</h3>

<p>ì „ì†¡ì€ êµ³ì´ FileReader ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³  Blob íƒ€ì…ì„ ê·¸ëŒ€ë¡œ í¸ë¦¬í•˜ê²Œ ì „ì†¡í•  ìˆ˜ ìˆë‹¤.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="kd">var</span> <span class="nx">xhr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
        <span class="nx">xhr</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="dl">"</span><span class="s2">POST</span><span class="dl">"</span><span class="p">,</span><span class="nx">url</span><span class="p">,</span><span class="kc">true</span><span class="p">);</span>
        <span class="nx">xhr</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">fileInput</span><span class="p">.</span><span class="nx">files</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
</code></pre></div></div>

<p>í•˜ì§€ë§Œ ë³´í†µ íŒŒì¼ ì „ì†¡ì„ ìœ„í•´ì„œëŠ” ë°”ì´ë„ˆë¦¬ íŒŒì¼ í•˜ë‚˜ë§Œ ë”± ë³´ë‚´ì§€ ì•Šê³ , HTML Formì—ì„œë„ ì‚¬ìš©í•œ â€œmultipart/form-dataâ€ í˜•ì‹ì„ ì‚¬ìš©í•œë‹¤. ì´ë¥¼ ìœ„í•´ì„œ FormData ê°ì²´ë¥¼ ìƒì„±í•˜ê³  íŒŒì¼ê°ì²´ë¥¼ í¬í•¨í•œ í•„ë“œë“¤ì„ ì¶”ê°€í•œë‹¤.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">formData</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FormData</span><span class="p">();</span>
<span class="nx">formData</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="dl">"</span><span class="s2">field1</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">value1</span><span class="dl">"</span><span class="p">);</span>
<span class="nx">formData</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="dl">"</span><span class="s2">field2</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">value2</span><span class="dl">"</span><span class="p">);</span>
<span class="p">...</span>
<span class="nx">formData</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="dl">"</span><span class="s2">file</span><span class="dl">"</span><span class="p">,</span><span class="nx">file</span><span class="p">);</span>
</code></pre></div></div>

<p>ê·¸ë¦¬ê³  ì´ í¼ ë°ì´í„°ë¥¼ XHR ê°ì²´ë¡œ ì „ì†¡í•œë‹¤. ì „ì†¡ì‹œ encrypt typeì„ ì„¤ì •í•´ì„œ ë³´ë‚´ì•¼ í•œë‹¤.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="kd">var</span> <span class="nx">xhr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
        <span class="nx">xhr</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="dl">"</span><span class="s2">POST</span><span class="dl">"</span><span class="p">,</span><span class="nx">url</span><span class="p">,</span><span class="kc">true</span><span class="p">);</span>
        <span class="nx">xhr</span><span class="p">.</span><span class="nx">enctype</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">multipart/form-data</span><span class="dl">"</span>
        <span class="nx">xhr</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">formData</span><span class="p">);</span>
</code></pre></div></div>

<h3 id="ì „ì†¡-ê³¼ì •-í‘œì‹œ">ì „ì†¡ ê³¼ì • í‘œì‹œ</h3>

<p>XHR ê°ì²´ì—ëŠ” ì „ì†¡ ê³¼ì •ì—ì„œ ê³„ì† ë°œìƒí•˜ëŠ” ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ê°€ ì´ ì„¸ê°œ ìˆë‹¤.</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">XMLHttpRequest.upload.onProgress</code> : ë°ì´í„°ë¥¼ ë¸Œë¼ìš°ì €ì—ì„œ ì„œë²„ë¡œ ì—…ë¡œë“œí•  ì‹œ ë°œìƒ</li>
  <li><code class="language-plaintext highlighter-rouge">XMLHttpRequest.download.onProgress</code> : ë°ì´í„°ë¥¼ ì„œë²„ì—ì„œ ë¸Œë¼ìš°ì €ë¡œ ë‹¤ìš´ë¡œë“œí•  ì‹œ ë°œìƒ</li>
  <li><code class="language-plaintext highlighter-rouge">XMLHttpRequest.onProgress</code> : <code class="language-plaintext highlighter-rouge">download.onProgress</code>ì™€ ë™ì¼ (bubbling upë˜ëŠ”ê²ƒì¸ì§€ëŠ” ì˜ ëª¨ë¥´ê² ë‹¤.)</li>
</ul>

<p>ì´ ì´ë²¤íŠ¸í•¸ë“¤ëŸ¬ëŠ” <code class="language-plaintext highlighter-rouge">addEventListener</code> ë¡œë„ ë“±ë¡ ê°€ëŠ¥í•˜ë©°, ì½œë°±ì— ì „ë‹¬ë˜ëŠ” ì´ë²¤íŠ¸ ê°ì²´ ì•ˆì—ëŠ” ì´ ì „ì†¡í•  ë°ì´í„°ê°€ ì–¼ë§ˆì´ê³  ê·¸ ì¤‘ì— ì–¼ë§ˆë‚˜ ì™„ë£Œë˜ì—ˆëŠ”ì§€ê°€ ë“¤ì–´ìˆë‹¤. ë‹¤ìŒê³¼ ê°™ì´ í™œìš© ê°€ëŠ¥í•˜ë‹¤.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">xhr</span><span class="p">.</span><span class="nx">upload</span><span class="p">.</span><span class="nx">onprogress</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">((</span><span class="nx">e</span><span class="p">.</span><span class="nx">loaded</span> <span class="o">/</span> <span class="nx">e</span><span class="p">.</span><span class="nx">total</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">);</span>   <span class="c1">//ì „ì†¡ ê³¼ì •ì„ í¼ì„¼íŠ¸ë¡œ ë³´ì—¬ì¤€ë‹¤.</span>
<span class="p">};</span>
</code></pre></div></div>

<h2 id="jqueryajax-í™œìš©">jQuery.ajax í™œìš©</h2>

<p>ì¢€ ì§œì¦ë‚˜ëŠ” ì¼ì´ì§€ë§Œ, XHRê°ì²´ë¥¼ í‘œì¤€ì ìœ¼ë¡œ ì§€ì› ì•ˆí•˜ëŠ” ë¸Œë¼ìš°ì €ì˜ í´ë¦¬í•„ì„ ìœ„í•´ì„œëŠ” jQuery ë“±ì˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ í™œìš©í•˜ëŠ” ê²ƒì´ í¸í•˜ë‹¤.
ì¼ë°˜ì ìœ¼ë¡œ POST ìš”ì²­ì„ ajax ë¡œ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ì„œëŠ” $.post ë¥¼ ì‚¬ìš©í•˜ë©´ í¸í•˜ì§€ë§Œ, multipart í˜•ì‹ì„ ì´ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” $.ajax ë¥¼ ì´ìš©í•´ì„œ ë‹¤ì†Œ ê·€ì°®ì€ ì„¸ë¶€ ì„¤ì •ì„ í•´ì£¼ì–´ì•¼ í•œë‹¤.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
    <span class="na">url</span> <span class="p">:</span> <span class="nx">url</span><span class="p">,</span>
    <span class="na">method</span> <span class="p">:</span> <span class="dl">'</span><span class="s1">POST</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">contentType</span> <span class="p">:</span> <span class="kc">false</span><span class="p">,</span>    <span class="c1">//ì´ ë¶€ë¶„ì„ "multipart/form-data" ë¼ê³  String ìœ¼ë¡œ í•˜ë“œì½”ë”© í•˜ë©´ boundary ì •ë³´ê°€ ì „ì†¡ë˜ì§€ ì•ŠëŠ”ë‹¤.</span>
    <span class="na">processData</span> <span class="p">:</span> <span class="kc">false</span><span class="p">,</span>   <span class="c1">//falseë¡œ overriding í•´ì£¼ì§€ ì•Šìœ¼ë©´ ë°”ì´ë„ˆë¦¬ ë°ì´í„°ë¥¼ form ìœ¼ë¡œ urlEncode í•˜ë ¤ê³  í•˜ë©´ì„œ $.paramì—ì„œ ì—ëŸ¬ê°€ ë°œìƒí•œë‹¤.</span>
    <span class="na">data</span> <span class="p">:</span> <span class="nx">formData</span><span class="p">,</span>  <span class="c1">//ìœ„ì—ì„œ ë§Œë“  FormData ê°ì²´ </span>
<span class="p">}).</span><span class="nx">done</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">){</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>  <span class="c1">//íŒŒì¼ ì „ì†¡ ì™„ë£Œ í›„ ì„œë²„ì¸¡ì—ì„œ ë³´ë‚´ì˜¨ ì‘ë‹µì„ ì²˜ë¦¬í•œë‹¤.</span>
<span class="p">});</span>
</code></pre></div></div>

<h3 id="onprogress-ì´ë²¤íŠ¸">onprogress ì´ë²¤íŠ¸</h3>

<p>jQuery.ajaxë¥¼ í™œìš©í•  ë•ŒëŠ” XHR ê°ì²´ë¥¼ ì§ì ‘ ìƒì„±í•´ì„œ ì‚¬ìš©í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ onprogress ì´ë²¤íŠ¸ë¥¼ ì²˜ë¦¬í•˜ê¸°ê°€ ê¹Œë‹¤ë¡­ë‹¤. ajax ì„¤ì • ì˜¤ë¸Œì íŠ¸ì˜ xhr í•„ë“œì— íŒ©í† ë¦¬ ë©”ì„œë“œë¥¼ ì§€ì •í•˜ë©´ XHR ê°ì²´ë¥¼ ì§ì ‘ ìƒì„±í•´ì„œ return í•  ìˆ˜ ìˆë‹¤. ê·¸ëŸ¬ë©´ ì—¬ê¸°ì—ì„œ ìƒì„±ëœ  XHR ê°ì²´ë¥¼ ì´ìš©í•´ì„œ ajax í†µì‹ ì„ ì²˜ë¦¬í•˜ë¯€ë¡œ ì´ ê°ì²´ì— ê¸°ì¡´ ë°©ì‹ëŒ€ë¡œ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ë¥¼ ë“±ë¡í•  ìˆ˜ ìˆë‹¤.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
    <span class="na">xhr</span> <span class="p">:</span> <span class="kd">function</span><span class="p">(){</span>
        <span class="kd">var</span> <span class="nx">xhr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
        <span class="nx">xhr</span><span class="p">.</span><span class="nx">upload</span><span class="p">.</span><span class="nx">onProgress</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">loaded</span> <span class="o">/</span> <span class="nx">e</span><span class="p">.</span><span class="nx">total</span><span class="p">);</span>
        <span class="p">};</span>
        <span class="k">return</span> <span class="nx">xhr</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">})</span>
</code></pre></div></div>

<p>ê·¸ëŸ°ë° ì´ëŸ° ë°©ì‹ì„ ì‚¬ìš©í•˜ë©´ í‘œì¤€ XHR ê°ì²´ë¥¼ ì§ì ‘ ìƒì„±í•˜ê²Œ ë˜ë¯€ë¡œ ë¸Œë¼ìš°ì € í˜¸í™˜ì„±ì„ í¸í•˜ê²Œ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ì„œ jQueryë¥¼ í™œìš©í•˜ëŠ” ì˜ì˜ê°€ ë¬´ìš©ì§€ë¬¼ì´ ëœë‹¤. ë”°ë¼ì„œ jQueryì—ì„œ ë¸Œë¼ìš°ì €ì— ë”°ë¼ ìƒì„±í•˜ëŠ” XHR ê°ì²´ë¥¼ ê°€ì ¸ì™€ì„œ í™œìš©í•´ì•¼ í•œë‹¤. ì´ë¥¼ ìœ„í•´ì„œ $.ajaxSettings ê°ì²´ë¥¼ ì´ìš©í•œë‹¤. ì´ ê°ì²´ì—ëŠ” ajax í†µì‹ ì„ í•˜ê¸°ìœ„í•´ì„œ ì„¤ì •í•œ url ì£¼ì†Œ ë“±ì˜ ê°ì • ì„¤ì •ê°’ê³¼, xhr ì´ë¼ëŠ” ë©”ì†Œë“œê°€ ë“¤ì–´ìˆëŠ”ë° ì´ ë©”ì†Œë“œë¥¼ ì´ìš©í•´ì„œ jQueryê°€ ìƒì„±í•œ XHR ê°ì²´ë¥¼ ì–»ì–´ì˜¬ ìˆ˜ ìˆë‹¤.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">xhr</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">ajaxSettings</span><span class="p">.</span><span class="nx">xhr</span><span class="p">();</span>
    
<span class="k">if</span><span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">upload</span><span class="p">){</span>  <span class="c1">//upload.onprogress ë¥¼ ì§€ì›í•˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì €ì—ì„œ upload ê°ì²´ê°€ undefinedë¼ì„œ ë‚˜ëŠ” ì—ëŸ¬ë¥¼ ë°©ì§€</span>
    <span class="nx">xhr</span><span class="p">.</span><span class="nx">upload</span><span class="p">.</span><span class="nx">onprogress</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">loaded</span> <span class="o">/</span> <span class="nx">e</span><span class="p">.</span><span class="nx">total</span><span class="p">);</span>
    <span class="p">};</span>
<span class="p">}</span> 

<span class="k">return</span> <span class="nx">xhr</span><span class="p">;</span>
</code></pre></div></div>

<h2 id="ì¢…í•©">ì¢…í•©</h2>

<p>ìœ„ì˜ ë‚´ìš©ì„ ëª¨ë‘ ì ìš©í•œ ì™„ì„±ëœ ì½”ë“œëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//íŒŒì¼ input ì„ ìƒì„±.  íŒŒì¼ ì§€ì •ì€ ìœ ì €ê°€ uië¥¼ í†µí•´ì„œ ì§ì ‘ í•´ì•¼í•œë‹¤.</span>
<span class="kd">var</span> <span class="nx">fileInput</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">"</span><span class="s2">input</span><span class="dl">"</span><span class="p">);</span>
<span class="nx">fileInput</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">file</span><span class="dl">"</span><span class="p">;</span>
<span class="nx">fileInput</span><span class="p">.</span><span class="nx">multiple</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">fileInput</span><span class="p">);</span>


<span class="kd">function</span> <span class="nx">uploadFile</span><span class="p">(</span><span class="nx">url</span><span class="p">){</span>
    <span class="c1">//í¼ ë°ì´í„° ìƒì„±</span>
    <span class="kd">var</span> <span class="nx">formData</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FormData</span><span class="p">();</span>
    <span class="nx">formData</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="dl">"</span><span class="s2">field1</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">value1</span><span class="dl">"</span><span class="p">);</span>
    <span class="nx">formData</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="dl">"</span><span class="s2">field2</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">value2</span><span class="dl">"</span><span class="p">);</span>
    <span class="p">...</span>
    <span class="nx">formData</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="dl">"</span><span class="s2">file</span><span class="dl">"</span><span class="p">,</span><span class="nx">fileInput</span><span class="p">.</span><span class="nx">files</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>

    <span class="c1">//ajaxì „ì†¡</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
        <span class="na">url</span> <span class="p">:</span> <span class="nx">url</span><span class="p">,</span>
        <span class="na">method</span> <span class="p">:</span> <span class="dl">'</span><span class="s1">POST</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">contentType</span> <span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="na">processData</span> <span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="na">data</span> <span class="p">:</span> <span class="nx">formData</span><span class="p">,</span>
        <span class="na">xhr</span> <span class="p">:</span> <span class="kd">function</span><span class="p">(){</span>
            <span class="kd">var</span> <span class="nx">xhr</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">ajaxSettings</span><span class="p">.</span><span class="nx">xhr</span><span class="p">();</span>
            <span class="k">if</span><span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">upload</span><span class="p">){</span>
                <span class="nx">xhr</span><span class="p">.</span><span class="nx">upload</span><span class="p">.</span><span class="nx">onprogress</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
                    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">loaded</span> <span class="o">/</span> <span class="nx">e</span><span class="p">.</span><span class="nx">total</span><span class="p">);</span>
                <span class="p">};</span>
            <span class="p">}</span> 
            
            <span class="k">return</span> <span class="nx">xhr</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}).</span><span class="nx">done</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">){</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">}</span>

</code></pre></div></div>

<p>file input ì— UIë¥¼ í†µí•´ì„œ íŒŒì¼ì„ ì§€ì •í•˜ê³  uploadFile(ì „ì†¡í•  ì£¼ì†Œ)ë¥¼ ì‹¤í–‰í•˜ë©´ íŒŒì¼ì´ ì „ì†¡ëœë‹¤.</p>

:ET